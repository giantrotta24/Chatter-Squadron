{"version":3,"sources":["../../src/bootstrap/get-config-file.js"],"names":["levenshtein","require","fs","testRequireError","default","report","chalk","path","existsSync","sync","isNearMatch","fileName","configName","distance","get","module","exports","getConfigFile","rootDir","configPath","join","configModule","err","nearMatch","readdir","then","files","find","file","split","pop","panic","bold"],"mappings":";;AACA,MAAMA,WAAW,GAAGC,OAAO,CAAE,kBAAF,CAA3B;;AACA,MAAMC,EAAE,GAAGD,OAAO,CAAE,UAAF,CAAlB;;AACA,MAAME,gBAAgB,GAAGF,OAAO,CAAE,6BAAF,CAAP,CAAuCG,OAAhE;;AACA,MAAMC,MAAM,GAAGJ,OAAO,CAAE,yBAAF,CAAtB;;AACA,MAAMK,KAAK,GAAGL,OAAO,CAAE,OAAF,CAArB;;AACA,MAAMM,IAAI,GAAGN,OAAO,CAAE,MAAF,CAApB;;AACA,MAAMO,UAAU,GAAGP,OAAO,CAAE,kBAAF,CAAP,CAA4BQ,IAA/C;;AAEA,SAASC,WAAT,CACEC,QADF,EAEEC,UAFF,EAGEC,QAHF,EAIW;AACT,SAAOb,WAAW,CAACc,GAAZ,CAAgBH,QAAhB,EAA0BC,UAA1B,KAAyCC,QAAhD;AACD;;AAEDE,MAAM,CAACC,OAAP,GAAiB,eAAeC,aAAf,CACfC,OADe,EAEfN,UAFe,EAGfC,QAAgB,GAAG,CAHJ,EAIf;AACA,QAAMM,UAAU,GAAGZ,IAAI,CAACa,IAAL,CAAUF,OAAV,EAAmBN,UAAnB,CAAnB;AACA,MAAIS,YAAJ;;AACA,MAAI;AACFA,IAAAA,YAAY,GAAGpB,OAAO,CAACkB,UAAD,CAAtB;AACD,GAFD,CAEE,OAAOG,GAAP,EAAY;AACZ,UAAMC,SAAS,GAAG,MAAMrB,EAAE,CAACsB,OAAH,CAAWN,OAAX,EAAoBO,IAApB,CAAyBC,KAAK,IACpDA,KAAK,CAACC,IAAN,CAAWC,IAAI,IAAI;AACjB,YAAMjB,QAAQ,GAAGiB,IAAI,CAACC,KAAL,CAAWX,OAAX,EAAoBY,GAApB,EAAjB;AACA,aAAOpB,WAAW,CAACC,QAAD,EAAWC,UAAX,EAAuBC,QAAvB,CAAlB;AACD,KAHD,CADsB,CAAxB;;AAMA,QAAI,CAACV,gBAAgB,CAACgB,UAAD,EAAaG,GAAb,CAArB,EAAwC;AACtCjB,MAAAA,MAAM,CAAC0B,KAAP,CACG,4DAA2DnB,UAAW,uCADzE,EAEEU,GAFF;AAID,KALD,MAKO,IAAIC,SAAJ,EAAe;AACpBlB,MAAAA,MAAM,CAAC0B,KAAP,CACG,wEAAuEzB,KAAK,CAAC0B,IAAN,CACtET,SADsE,CAEtE,SAAQjB,KAAK,CAAC0B,IAAN,CAAWpB,UAAX,CAAuB,GAHnC;AAKD,KANM,MAMA,IAAIJ,UAAU,CAACD,IAAI,CAACa,IAAL,CAAUF,OAAV,EAAoB,KAApB,EAA0BN,UAA1B,CAAD,CAAd,EAAuD;AAC5DP,MAAAA,MAAM,CAAC0B,KAAP,CACG,QAAOnB,UAAW,kJADrB;AAGD;AACF;;AAED,SAAOS,YAAP;AACD,CAnCD","sourcesContent":["/* @flow */\nconst levenshtein = require(`fast-levenshtein`)\nconst fs = require(`fs-extra`)\nconst testRequireError = require(`../utils/test-require-error`).default\nconst report = require(`gatsby-cli/lib/reporter`)\nconst chalk = require(`chalk`)\nconst path = require(`path`)\nconst existsSync = require(`fs-exists-cached`).sync\n\nfunction isNearMatch(\n  fileName: string,\n  configName: string,\n  distance: number\n): boolean {\n  return levenshtein.get(fileName, configName) <= distance\n}\n\nmodule.exports = async function getConfigFile(\n  rootDir: string,\n  configName: string,\n  distance: number = 3\n) {\n  const configPath = path.join(rootDir, configName)\n  let configModule\n  try {\n    configModule = require(configPath)\n  } catch (err) {\n    const nearMatch = await fs.readdir(rootDir).then(files =>\n      files.find(file => {\n        const fileName = file.split(rootDir).pop()\n        return isNearMatch(fileName, configName, distance)\n      })\n    )\n    if (!testRequireError(configPath, err)) {\n      report.panic(\n        `We encountered an error while trying to load your site's ${configName}. Please fix the error and try again.`,\n        err\n      )\n    } else if (nearMatch) {\n      report.panic(\n        `It looks like you were trying to add the config file? Please rename \"${chalk.bold(\n          nearMatch\n        )}\" to \"${chalk.bold(configName)}\"`\n      )\n    } else if (existsSync(path.join(rootDir, `src`, configName))) {\n      report.panic(\n        `Your ${configName} file is in the wrong place. You've placed it in the src/ directory. It must instead be at the root of your site next to your package.json file.`\n      )\n    }\n  }\n\n  return configModule\n}\n"],"file":"get-config-file.js"}